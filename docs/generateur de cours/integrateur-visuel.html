<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Int√©grateur Visuel Am√©lior√©</title>
    <style>
        /* Styles CSS int√©gr√©s pour une meilleure UX */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: calc(100vh - 40px);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            min-height: 600px;
        }

        .sidebar {
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding: 25px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-input-zone {
            border: 2px dashed #6c757d;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .file-input-zone:hover {
            border-color: #4facfe;
            background: #f8f9ff;
        }

        .file-input-zone.dragover {
            border-color: #00f2fe;
            background: #e3f2fd;
            transform: scale(1.02);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .image-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 6px;
            overflow: hidden;
            cursor: grab;
            transition: transform 0.2s ease;
            border: 2px solid transparent;
        }

        .image-item:hover {
            transform: scale(1.05);
            border-color: #4facfe;
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-item .remove-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 20px;
            height: 20px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .editor-area {
            padding: 25px;
        }

        .editor-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .split-view {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            height: 500px;
        }

        .split-view.show-code {
            grid-template-columns: 1fr 1fr;
        }

        .code-editor {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            display: none;
        }

        .split-view.show-code .code-editor {
            display: block;
        }

        .editor-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #dee2e6;
            font-weight: 600;
            color: #495057;
        }

        textarea {
            width: 100%;
            height: calc(100% - 45px);
            border: none;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            outline: none;
        }

        .preview-panel {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-frame {
            width: 100%;
            height: calc(100% - 45px);
            border: none;
            background: white;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 8px 15px;
            border-top: 1px solid #dee2e6;
            font-size: 0.9em;
            color: #6c757d;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: #dc3545;
        }

        .shortcuts-help {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }

        .shortcuts-help h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .shortcuts-help ul {
            list-style: none;
            color: #856404;
        }

        .shortcuts-help li {
            margin-bottom: 5px;
        }

        .progress-indicator {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            width: 0%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .split-view {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .code-editor, .preview-panel {
                height: 300px;
            }
        }

        /* Animations d'am√©lioration UX */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            animation: fadeIn 0.6s ease forwards;
        }

        .drop-indicator {
            position: absolute;
            width: 2px;
            background: #4facfe;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .drop-indicator.visible {
            opacity: 1;
        }

        /* Styles pour l'insertion visuelle dans l'aper√ßu */
        .preview-frame.insert-mode {
            cursor: crosshair !important;
        }

        .preview-frame.insert-mode * {
            cursor: crosshair !important;
            outline: 1px dashed #4facfe !important;
        }

        .preview-frame.insert-mode *:hover {
            background-color: rgba(79, 172, 254, 0.1) !important;
            outline: 2px solid #4facfe !important;
        }

        .insert-indicator {
            position: absolute;
            background: #4facfe;
            color: white;
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .insert-indicator.visible {
            opacity: 1;
        }

        .image-selected {
            border: 3px solid #4facfe !important;
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.5) !important;
        }

        /* Panneau de contr√¥les d'images visuels */
        .image-controls {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            display: none;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .image-controls.visible {
            display: block;
            animation: slideIn 0.3s ease;
        }

        /* Panneau de contr√¥les flottant apr√®s placement */
        .floating-controls {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            min-width: 280px;
        }

        .floating-controls.visible {
            display: block;
            animation: slideInRight 0.4s ease;
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translate(100%, -50%); }
            to { opacity: 1; transform: translate(0, -50%); }
        }

        .floating-header {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .control-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: #28a745;
            color: white;
        }

        .action-btn.primary:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .action-btn.secondary {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .action-btn.secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Contr√¥les de type d'int√©gration */
        .integration-type-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 8px;
            margin: 0 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            color: white;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .radio-option input[type="radio"] {
            margin: 0;
            transform: scale(1.1);
        }

        .radio-option:hover {
            color: #4facfe;
        }

        .radio-option input[type="radio"]:checked + span {
            color: #4facfe;
            font-weight: 600;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-label {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 12px;
            display: block;
            text-align: center;
        }

        .visual-size-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .size-preview {
            cursor: pointer;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .size-preview:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .size-preview.active {
            background: rgba(255,255,255,0.3);
            border-color: white;
        }

        .size-demo {
            width: 100%;
            height: 20px;
            background: white;
            border-radius: 3px;
            margin-bottom: 5px;
        }

        .size-demo.small { width: 25px; }
        .size-demo.medium { width: 40px; }
        .size-demo.large { width: 60px; }

        .position-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .position-btn {
            width: 60px;
            height: 50px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            transition: all 0.3s ease;
            color: white;
        }

        .position-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        .position-btn.active {
            background: rgba(255,255,255,0.3);
            border-color: white;
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .style-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .style-btn {
            padding: 10px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 0.9em;
            transition: all 0.3s ease;
            color: white;
        }

        .style-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .style-btn.active {
            background: rgba(255,255,255,0.3);
            border-color: white;
        }

        .size-slider {
            width: 100%;
            margin: 10px 0;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.3);
            outline: none;
        }

        .size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .size-display {
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® L'Int√©grateur Visuel Am√©lior√©</h1>
            <p>Int√©grez facilement vos images dans vos fichiers HTML avec une interface intuitive</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="section">
                    <div class="section-title">
                        üìÅ Charger un fichier HTML
                    </div>
                    <div class="file-input-zone" id="htmlDropZone">
                        <input type="file" id="htmlFileInput" accept=".html" style="display: none;">
                        <div>
                            <div style="font-size: 2em; margin-bottom: 10px;">üìÑ</div>
                            <div>Glissez votre fichier HTML ici</div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-primary" onclick="document.getElementById('htmlFileInput').click()">
                                    Parcourir
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">
                        üñºÔ∏è Palette d'images
                    </div>
                    <div class="file-input-zone" id="imageDropZone">
                        <input type="file" id="imageFileInput" accept="image/*" multiple style="display: none;">
                        <div>
                            <div style="font-size: 2em; margin-bottom: 10px;">üñºÔ∏è</div>
                            <div>Glissez vos images ici</div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-primary" onclick="document.getElementById('imageFileInput').click()">
                                    Ajouter des images
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="images-grid" id="imagesGrid"></div>
                    
                    <!-- Contr√¥les visuels de l'image s√©lectionn√©e -->
                    <div class="image-controls" id="imageControls">
                        <div class="control-group">
                            <span class="control-label">üìè Taille de l'image</span>
                            <div class="visual-size-controls">
                                <div class="size-preview active" onclick="integrator.setImageSize('25%')" id="size-small">
                                    <div class="size-demo small"></div>
                                    <div>Petit</div>
                                </div>
                                <div class="size-preview" onclick="integrator.setImageSize('50%')" id="size-medium">
                                    <div class="size-demo medium"></div>
                                    <div>Moyen</div>
                                </div>
                                <div class="size-preview" onclick="integrator.setImageSize('100%')" id="size-large">
                                    <div class="size-demo large"></div>
                                    <div>Grand</div>
                                </div>
                            </div>
                            <input type="range" class="size-slider" id="sizeSlider" min="10" max="100" value="100" 
                                   oninput="integrator.setSizeFromSlider(this.value)">
                            <div class="size-display" id="sizeDisplay">100%</div>
                        </div>
                        
                        <div class="control-group">
                            <span class="control-label">üìç Position de l'image</span>
                            <div class="position-controls">
                                <div class="position-btn" onclick="integrator.setImageAlignment('left')" id="pos-left">
                                    ‚¨ÖÔ∏è
                                </div>
                                <div class="position-btn active" onclick="integrator.setImageAlignment('center')" id="pos-center">
                                    ‚¨ÜÔ∏è
                                </div>
                                <div class="position-btn" onclick="integrator.setImageAlignment('right')" id="pos-right">
                                    ‚û°Ô∏è
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <span class="control-label">üé® Style d'affichage</span>
                            <div class="style-controls">
                                <div class="style-btn active" onclick="integrator.setImageDisplay('block')" id="style-block">
                                    üìÑ Image seule
                                </div>
                                <div class="style-btn" onclick="integrator.setImageDisplay('inline')" id="style-inline">
                                    üìù Dans le texte
                                </div>
                                <div class="style-btn" onclick="integrator.setImageDisplay('float-left')" id="style-float-left">
                                    ‚¨ÖÔ∏è Texte √† droite
                                </div>
                                <div class="style-btn" onclick="integrator.setImageDisplay('float-right')" id="style-float-right">
                                    ‚û°Ô∏è Texte √† gauche
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">
                        üìä Progression
                    </div>
                    <div class="progress-indicator">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: #6c757d;" id="progressText">
                            Pr√™t √† commencer
                        </div>
                    </div>
                </div>

                <div class="shortcuts-help">
                    <h4>‚å®Ô∏è Raccourcis clavier</h4>
                    <ul>
                        <li><strong>Ctrl+S</strong> : Sauvegarder</li>
                        <li><strong>Ctrl+Z</strong> : Annuler</li>
                        <li><strong>Ctrl+Y</strong> : R√©tablir</li>
                        <li><strong>F5</strong> : Actualiser l'aper√ßu</li>
                    </ul>
                </div>
            </div>

            <div class="editor-area">
                <div class="editor-controls">
                    <button class="btn btn-primary" id="insertModeBtn" onclick="integrator.toggleInsertMode()">
                        üéØ Mode placement d'images
                    </button>
                    <div class="integration-type-controls">
                        <label class="radio-option">
                            <input type="radio" name="integrationType" value="base64" checked onchange="integrator.setIntegrationType('base64')">
                            <span>üì¶ Int√©gr√©</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="integrationType" value="file" onchange="integrator.setIntegrationType('file')">
                            <span>üìÅ Fichiers</span>
                        </label>
                    </div>
                    <button class="btn btn-secondary" id="toggleCodeBtn" onclick="integrator.toggleCodeEditor()">
                        üìù Afficher le code
                    </button>
                    <button class="btn btn-secondary" onclick="integrator.refreshPreview()">
                        üîÑ Actualiser
                    </button>
                    <button class="btn btn-secondary" onclick="integrator.downloadHTML()">
                        üíæ T√©l√©charger HTML
                    </button>
                    <button class="btn btn-secondary" onclick="integrator.clearAll()">
                        üóëÔ∏è Tout effacer
                    </button>
                </div>

                <div class="split-view">
                    <div class="code-editor">
                        <div class="editor-header">
                            üìù √âditeur HTML
                        </div>
                        <textarea id="htmlEditor" placeholder="Votre code HTML appara√Ætra ici...

Conseils d'utilisation :
1. Chargez d'abord un fichier HTML
2. Ajoutez vos images dans la palette
3. Glissez-d√©posez les images dans l'√©diteur
4. Utilisez les raccourcis pour plus d'efficacit√©"></textarea>
                    </div>

                    <div class="preview-panel">
                        <div class="editor-header">
                            üåê Votre page HTML - Cliquez pour placer vos images
                        </div>
                        <iframe id="previewFrame" class="preview-frame"></iframe>
                    </div>
                </div>

                <div class="status-bar" id="statusBar">
                    Pr√™t ‚Ä¢ Aucun fichier charg√© ‚Ä¢ 0 images
                </div>
            </div>
        </div>
    </div>

    <!-- Indicateur de zone de d√©p√¥t -->
    <div class="drop-indicator" id="dropIndicator"></div>
    
    <!-- Indicateur d'insertion visuelle -->
    <div class="insert-indicator" id="insertIndicator">Cliquez pour ins√©rer l'image ici</div>
    
    <!-- Panneau de contr√¥les flottant apr√®s placement -->
    <div class="floating-controls" id="floatingControls">
        <div class="floating-header">üé® Ajuster votre image</div>
        
        <div class="control-group">
            <span class="control-label">üìè Taille de l'image</span>
            <div class="visual-size-controls">
                <div class="size-preview" onclick="integrator.adjustImageSize('25%')" id="float-size-small">
                    <div class="size-demo small"></div>
                    <div>Petit</div>
                </div>
                <div class="size-preview" onclick="integrator.adjustImageSize('50%')" id="float-size-medium">
                    <div class="size-demo medium"></div>
                    <div>Moyen</div>
                </div>
                <div class="size-preview active" onclick="integrator.adjustImageSize('100%')" id="float-size-large">
                    <div class="size-demo large"></div>
                    <div>Grand</div>
                </div>
            </div>
            <input type="range" class="size-slider" id="floatSizeSlider" min="10" max="100" value="100" 
                   oninput="integrator.adjustImageSizeFromSlider(this.value)">
            <div class="size-display" id="floatSizeDisplay">100%</div>
        </div>
        
        <div class="control-group">
            <span class="control-label">üìç Position de l'image</span>
            <div class="position-controls">
                <div class="position-btn" onclick="integrator.adjustImageAlignment('left')" id="float-pos-left">
                    ‚¨ÖÔ∏è
                </div>
                <div class="position-btn active" onclick="integrator.adjustImageAlignment('center')" id="float-pos-center">
                    ‚¨ÜÔ∏è
                </div>
                <div class="position-btn" onclick="integrator.adjustImageAlignment('right')" id="float-pos-right">
                    ‚û°Ô∏è
                </div>
            </div>
        </div>
        
        <div class="control-group">
            <span class="control-label">üé® Style d'affichage</span>
            <div class="style-controls">
                <div class="style-btn active" onclick="integrator.adjustImageDisplay('block')" id="float-style-block">
                    üìÑ Image seule
                </div>
                <div class="style-btn" onclick="integrator.adjustImageDisplay('inline')" id="float-style-inline">
                    üìù Dans le texte
                </div>
                <div class="style-btn" onclick="integrator.adjustImageDisplay('float-left')" id="float-style-float-left">
                    ‚¨ÖÔ∏è Texte √† droite
                </div>
                <div class="style-btn" onclick="integrator.adjustImageDisplay('float-right')" id="float-style-float-right">
                    ‚û°Ô∏è Texte √† gauche
                </div>
            </div>
        </div>
        
        <div class="control-actions">
            <button class="action-btn primary" onclick="integrator.validateImagePlacement()">
                ‚úÖ Valider
            </button>
            <button class="action-btn secondary" onclick="integrator.cancelImagePlacement()">
                ‚ùå Annuler
            </button>
        </div>
    </div>

    <script>
        // JavaScript int√©gr√© pour toute la fonctionnalit√©
        class VisualIntegrator {
            constructor() {
                this.htmlContent = '';
                this.images = [];
                this.undoStack = [];
                this.redoStack = [];
                this.selectedImage = null;
                this.insertMode = false;
                this.previewDocument = null;
                this.currentImageSettings = {
                    size: '100%',
                    alignment: 'center',
                    display: 'block'
                };
                this.currentlyEditingImage = null; // L'image en cours d'√©dition
                this.tempImageElement = null; // R√©f√©rence temporaire de l'image
                this.integrationType = 'base64'; // 'base64' ou 'file'
                this.imageFiles = []; // Stockage des fichiers pour mode 'file'
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateProgress();
            }

            setupEventListeners() {
                // Gestion des fichiers HTML
                const htmlDropZone = document.getElementById('htmlDropZone');
                const htmlFileInput = document.getElementById('htmlFileInput');

                htmlDropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    htmlDropZone.classList.add('dragover');
                });

                htmlDropZone.addEventListener('dragleave', () => {
                    htmlDropZone.classList.remove('dragover');
                });

                htmlDropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    htmlDropZone.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0 && files[0].type === 'text/html') {
                        this.loadHTMLFile(files[0]);
                    }
                });

                htmlFileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.loadHTMLFile(e.target.files[0]);
                    }
                });

                // Gestion des images
                const imageDropZone = document.getElementById('imageDropZone');
                const imageFileInput = document.getElementById('imageFileInput');

                imageDropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    imageDropZone.classList.add('dragover');
                });

                imageDropZone.addEventListener('dragleave', () => {
                    imageDropZone.classList.remove('dragover');
                });

                imageDropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    imageDropZone.classList.remove('dragover');
                    const files = Array.from(e.dataTransfer.files).filter(file => 
                        file.type.startsWith('image/')
                    );
                    this.loadImages(files);
                });

                imageFileInput.addEventListener('change', (e) => {
                    const files = Array.from(e.target.files);
                    this.loadImages(files);
                });

                // √âditeur de code
                const htmlEditor = document.getElementById('htmlEditor');
                htmlEditor.addEventListener('input', () => {
                    this.htmlContent = htmlEditor.value;
                    this.refreshPreview();
                });

                // Raccourcis clavier
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey) {
                        switch(e.key) {
                            case 's':
                                e.preventDefault();
                                this.downloadHTML();
                                break;
                            case 'z':
                                e.preventDefault();
                                this.undo();
                                break;
                            case 'y':
                                e.preventDefault();
                                this.redo();
                                break;
                        }
                    }
                    if (e.key === 'F5') {
                        e.preventDefault();
                        this.refreshPreview();
                    }
                });

                // Glisser-d√©poser dans l'√©diteur
                htmlEditor.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.showDropIndicator(e);
                });

                htmlEditor.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.hideDropIndicator();
                    const imageId = e.dataTransfer.getData('text/plain');
                    if (imageId) {
                        const image = this.images.find(img => img.id === imageId);
                        if (image) {
                            this.insertImageAtPosition(image, this.getCaretPosition(htmlEditor));
                        }
                    }
                });
            }

            loadHTMLFile(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.saveState();
                    this.htmlContent = e.target.result;
                    document.getElementById('htmlEditor').value = this.htmlContent;
                    this.refreshPreview();
                    this.updateProgress();
                    this.showToast('Fichier HTML charg√© avec succ√®s!', 'success');
                };
                reader.readAsText(file);
            }

            loadImages(files) {
                files.forEach(file => {
                    // Stocker le fichier original pour le mode 'file'
                    this.imageFiles.push(file);
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const image = {
                            id: 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                            name: file.name,
                            dataUrl: e.target.result,
                            size: file.size,
                            fileName: file.name.replace(/[^a-zA-Z0-9.-]/g, '_') // Nom s√©curis√© pour fichier
                        };
                        this.images.push(image);
                        this.renderImageGrid();
                        this.updateProgress();
                        this.showToast(`Image "${file.name}" ajout√©e!`, 'success');
                    };
                    reader.readAsDataURL(file);
                });
            }

            setIntegrationType(type) {
                this.integrationType = type;
                const typeText = type === 'base64' ? 'Int√©gr√© (base64)' : 'Fichiers s√©par√©s';
                this.showToast(`Mode d'int√©gration : ${typeText}`, 'info');
            }

            renderImageGrid() {
                const grid = document.getElementById('imagesGrid');
                grid.innerHTML = '';

                this.images.forEach(image => {
                    const item = document.createElement('div');
                    item.className = 'image-item';
                    item.draggable = true;
                    
                    // Ajouter la classe de s√©lection si cette image est s√©lectionn√©e
                    if (this.selectedImage && this.selectedImage.id === image.id) {
                        item.classList.add('image-selected');
                    }
                    
                    item.innerHTML = `
                        <img src="${image.dataUrl}" alt="${image.name}" title="${image.name}">
                        <button class="remove-btn" onclick="integrator.removeImage('${image.id}')">&times;</button>
                    `;

                    // √âv√©nement de clic pour s√©lectionner l'image
                    item.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.selectImage(image);
                    });

                    item.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', image.id);
                        this.selectImage(image);
                    });

                    grid.appendChild(item);
                });
            }

            selectImage(image) {
                this.selectedImage = image;
                this.renderImageGrid(); // Re-rendre pour mettre √† jour la s√©lection visuelle
                this.showImageControls();
                this.showToast(`Image "${image.name}" s√©lectionn√©e`, 'success');
            }

            showImageControls() {
                const controls = document.getElementById('imageControls');
                if (this.selectedImage) {
                    controls.classList.add('visible');
                    this.updateVisualControls(); // Mettre √† jour les contr√¥les visuels
                } else {
                    controls.classList.remove('visible');
                }
            }

            removeImage(imageId) {
                this.images = this.images.filter(img => img.id !== imageId);
                this.renderImageGrid();
                this.updateProgress();
                this.showToast('Image supprim√©e', 'success');
            }

            insertImageAtPosition(image, position) {
                this.saveState();
                const htmlEditor = document.getElementById('htmlEditor');
                const beforeText = this.htmlContent.substring(0, position);
                const afterText = this.htmlContent.substring(position);
                
                const imageTag = `<img src="${image.dataUrl}" alt="${image.name}" style="max-width: 100%; height: auto;">`;
                
                this.htmlContent = beforeText + imageTag + afterText;
                htmlEditor.value = this.htmlContent;
                this.refreshPreview();
                this.showToast(`Image "${image.name}" ins√©r√©e!`, 'success');
            }

            insertAtCursor() {
                if (!this.selectedImage) {
                    this.showToast('S√©lectionnez d\'abord une image √† ins√©rer', 'error');
                    return;
                }

                const htmlEditor = document.getElementById('htmlEditor');
                const position = htmlEditor.selectionStart;
                this.insertImageAtPosition(this.selectedImage, position);
            }

            refreshPreview() {
                const previewFrame = document.getElementById('previewFrame');
                const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                doc.open();
                doc.write(this.htmlContent);
                doc.close();
                
                // Configurer les √©v√©nements pour le mode insertion
                this.previewDocument = doc;
                if (this.insertMode) {
                    this.setupPreviewClickEvents();
                }
            }

            setupPreviewClickEvents() {
                if (!this.previewDocument) return;
                
                // Ajouter les √©v√©nements de clic pour l'insertion visuelle
                this.previewDocument.addEventListener('click', (e) => {
                    if (this.insertMode && this.selectedImage) {
                        e.preventDefault();
                        this.insertImageAtElement(e.target);
                    }
                });

                // Ajouter les √©v√©nements de survol
                this.previewDocument.addEventListener('mouseover', (e) => {
                    if (this.insertMode) {
                        this.showInsertIndicator(e);
                    }
                });

                this.previewDocument.addEventListener('mouseout', (e) => {
                    if (this.insertMode) {
                        this.hideInsertIndicator();
                    }
                });
            }

            insertImageAtElement(element) {
                if (!this.selectedImage) {
                    this.showToast('S√©lectionnez d\'abord une image √† ins√©rer', 'error');
                    return;
                }

                this.saveState();
                
                // Cr√©er l'√©l√©ment image avec une taille par d√©faut
                const imgElement = this.previewDocument.createElement('img');
                
                // Choisir la source selon le type d'int√©gration
                if (this.integrationType === 'base64') {
                    imgElement.src = this.selectedImage.dataUrl;
                } else {
                    // Mode fichier : utiliser directement le nom de fichier (m√™me dossier)
                    imgElement.src = this.selectedImage.fileName;
                }
                
                imgElement.alt = this.selectedImage.name;
                
                // Style de base pour placement initial
                imgElement.style.width = '100%';
                imgElement.style.height = 'auto';
                imgElement.style.display = 'block';
                imgElement.style.margin = '10px auto';
                imgElement.style.border = '3px dashed #4facfe';
                imgElement.style.padding = '5px';
                
                // Ins√©rer l'image apr√®s l'√©l√©ment cliqu√©
                if (element.parentNode) {
                    element.parentNode.insertBefore(imgElement, element.nextSibling);
                } else {
                    this.previewDocument.body.appendChild(imgElement);
                }
                
                // Stocker la r√©f√©rence de l'image en cours d'√©dition
                this.tempImageElement = imgElement;
                this.currentlyEditingImage = this.selectedImage;
                
                // Afficher le panneau de contr√¥les flottant
                this.showFloatingControls();
                
                // Sortir du mode insertion
                this.toggleInsertMode();
                
                this.showToast(`Image plac√©e ! Ajustez sa taille et position, puis validez`, 'success');
            }

            applyImageStyle(imgElement) {
                const settings = this.currentImageSettings;
                
                // Cr√©er le style CSS complet pour l'image
                let styleString = '';
                
                // Taille
                if (settings.size.includes('%') || settings.size.includes('px')) {
                    styleString += `width: ${settings.size}; `;
                } else {
                    styleString += 'width: 100%; ';
                }
                styleString += 'height: auto; ';
                
                // Positionnement selon le type d'affichage
                switch (settings.display) {
                    case 'block':
                        styleString += 'display: block; margin: 10px ';
                        if (settings.alignment === 'center') {
                            styleString += 'auto;';
                        } else if (settings.alignment === 'left') {
                            styleString += '0 auto 0 0;';
                        } else if (settings.alignment === 'right') {
                            styleString += '0 0 0 auto;';
                        }
                        break;
                        
                    case 'inline':
                        styleString += 'display: inline; vertical-align: middle; margin: 0 5px;';
                        break;
                        
                    case 'float-left':
                        styleString += 'float: left; margin: 0 15px 10px 0; clear: left;';
                        break;
                        
                    case 'float-right':
                        styleString += 'float: right; margin: 0 0 10px 15px; clear: right;';
                        break;
                }
                
                // Appliquer le style directement
                imgElement.style.cssText = styleString;
                
                return imgElement;
            }

            setImageSize(size) {
                this.currentImageSettings.size = size;
                this.updateVisualControls();
                this.showToast(`Taille : ${size}`, 'success');
            }

            setSizeFromSlider(value) {
                this.currentImageSettings.size = value + '%';
                document.getElementById('sizeDisplay').textContent = value + '%';
                this.updateVisualControls();
            }

            setImageAlignment(alignment) {
                this.currentImageSettings.alignment = alignment;
                this.updateVisualControls();
                const alignText = alignment === 'left' ? 'Gauche' : alignment === 'center' ? 'Centre' : 'Droite';
                this.showToast(`Position : ${alignText}`, 'success');
            }

            setImageDisplay(display) {
                this.currentImageSettings.display = display;
                this.updateVisualControls();
                const displayText = {
                    'block': 'Image seule',
                    'inline': 'Dans le texte', 
                    'float-left': 'Texte √† droite',
                    'float-right': 'Texte √† gauche'
                }[display];
                this.showToast(`Style : ${displayText}`, 'success');
            }

            updateVisualControls() {
                // R√©initialiser tous les contr√¥les visuels
                document.querySelectorAll('.size-preview, .position-btn, .style-btn').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Mettre √† jour les contr√¥les de taille
                const settings = this.currentImageSettings;
                if (settings.size === '25%') {
                    document.getElementById('size-small').classList.add('active');
                } else if (settings.size === '50%') {
                    document.getElementById('size-medium').classList.add('active');
                } else if (settings.size === '100%') {
                    document.getElementById('size-large').classList.add('active');
                }
                
                // Mettre √† jour le curseur
                const sizeValue = parseInt(settings.size.replace('%', ''));
                if (!isNaN(sizeValue)) {
                    document.getElementById('sizeSlider').value = sizeValue;
                    document.getElementById('sizeDisplay').textContent = settings.size;
                }
                
                // Mettre √† jour les contr√¥les de position
                document.getElementById('pos-' + settings.alignment).classList.add('active');
                
                // Mettre √† jour les contr√¥les de style
                document.getElementById('style-' + settings.display.replace('-', '-')).classList.add('active');
            }

            // Nouvelles fonctions pour le workflow apr√®s placement
            showFloatingControls() {
                const controls = document.getElementById('floatingControls');
                controls.classList.add('visible');
                this.updateFloatingControls();
            }

            hideFloatingControls() {
                const controls = document.getElementById('floatingControls');
                controls.classList.remove('visible');
            }

            updateFloatingControls() {
                // R√©initialiser tous les contr√¥les flottants
                document.querySelectorAll('#floatingControls .size-preview, #floatingControls .position-btn, #floatingControls .style-btn').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Mettre √† jour selon les param√®tres actuels
                const settings = this.currentImageSettings;
                
                // Taille
                if (settings.size === '25%') {
                    document.getElementById('float-size-small').classList.add('active');
                } else if (settings.size === '50%') {
                    document.getElementById('float-size-medium').classList.add('active');
                } else if (settings.size === '100%') {
                    document.getElementById('float-size-large').classList.add('active');
                }
                
                // Curseur
                const sizeValue = parseInt(settings.size.replace('%', ''));
                if (!isNaN(sizeValue)) {
                    document.getElementById('floatSizeSlider').value = sizeValue;
                    document.getElementById('floatSizeDisplay').textContent = settings.size;
                }
                
                // Position
                document.getElementById('float-pos-' + settings.alignment).classList.add('active');
                
                // Style
                document.getElementById('float-style-' + settings.display.replace('-', '-')).classList.add('active');
            }

            // Fonctions d'ajustement en temps r√©el
            adjustImageSize(size) {
                if (!this.tempImageElement) return;
                
                this.currentImageSettings.size = size;
                this.tempImageElement.style.width = size;
                this.updateFloatingControls();
                this.showToast(`Taille ajust√©e √† ${size}`, 'success');
            }

            adjustImageSizeFromSlider(value) {
                if (!this.tempImageElement) return;
                
                const size = value + '%';
                this.currentImageSettings.size = size;
                this.tempImageElement.style.width = size;
                document.getElementById('floatSizeDisplay').textContent = size;
                this.updateFloatingControls();
            }

            adjustImageAlignment(alignment) {
                if (!this.tempImageElement) return;
                
                this.currentImageSettings.alignment = alignment;
                
                // Appliquer l'alignement
                if (alignment === 'left') {
                    this.tempImageElement.style.margin = '10px auto 10px 0';
                    this.tempImageElement.style.textAlign = 'left';
                } else if (alignment === 'center') {
                    this.tempImageElement.style.margin = '10px auto';
                    this.tempImageElement.style.textAlign = 'center';
                } else if (alignment === 'right') {
                    this.tempImageElement.style.margin = '10px 0 10px auto';
                    this.tempImageElement.style.textAlign = 'right';
                }
                
                this.updateFloatingControls();
                const alignText = alignment === 'left' ? 'Gauche' : alignment === 'center' ? 'Centre' : 'Droite';
                this.showToast(`Position : ${alignText}`, 'success');
            }

            adjustImageDisplay(display) {
                if (!this.tempImageElement) return;
                
                this.currentImageSettings.display = display;
                
                // Appliquer le style d'affichage
                if (display === 'block') {
                    this.tempImageElement.style.display = 'block';
                    this.tempImageElement.style.float = 'none';
                } else if (display === 'inline') {
                    this.tempImageElement.style.display = 'inline';
                    this.tempImageElement.style.float = 'none';
                    this.tempImageElement.style.margin = '0 5px';
                } else if (display === 'float-left') {
                    this.tempImageElement.style.display = 'block';
                    this.tempImageElement.style.float = 'left';
                    this.tempImageElement.style.margin = '0 15px 10px 0';
                } else if (display === 'float-right') {
                    this.tempImageElement.style.display = 'block';
                    this.tempImageElement.style.float = 'right';
                    this.tempImageElement.style.margin = '0 0 10px 15px';
                }
                
                this.updateFloatingControls();
                const displayText = {
                    'block': 'Image seule',
                    'inline': 'Dans le texte',
                    'float-left': 'Texte √† droite',
                    'float-right': 'Texte √† gauche'
                }[display];
                this.showToast(`Style : ${displayText}`, 'success');
            }

            // Validation du placement
            validateImagePlacement() {
                if (!this.tempImageElement) return;
                
                // Supprimer la bordure de pr√©visualisation
                this.tempImageElement.style.border = 'none';
                this.tempImageElement.style.padding = '0';
                
                // Mettre √† jour le code HTML final
                this.htmlContent = this.previewDocument.documentElement.outerHTML;
                document.getElementById('htmlEditor').value = this.htmlContent;
                
                // Nettoyer les r√©f√©rences temporaires
                this.tempImageElement = null;
                this.currentlyEditingImage = null;
                
                // Cacher le panneau flottant
                this.hideFloatingControls();
                
                this.showToast('Image valid√©e et int√©gr√©e avec succ√®s !', 'success');
            }

            // Annulation du placement
            cancelImagePlacement() {
                if (!this.tempImageElement) return;
                
                // Supprimer l'image temporaire
                this.tempImageElement.remove();
                
                // Nettoyer les r√©f√©rences temporaires
                this.tempImageElement = null;
                this.currentlyEditingImage = null;
                
                // Cacher le panneau flottant
                this.hideFloatingControls();
                
                this.showToast('Placement annul√©', 'info');
            }

            toggleInsertMode() {
                this.insertMode = !this.insertMode;
                const btn = document.getElementById('insertModeBtn');
                const previewFrame = document.getElementById('previewFrame');
                
                if (this.insertMode) {
                    if (!this.selectedImage) {
                        this.showToast('S√©lectionnez d\'abord une image dans la palette', 'error');
                        this.insertMode = false;
                        return;
                    }
                    
                    btn.textContent = '‚ùå Arr√™ter le placement';
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-secondary');
                    previewFrame.classList.add('insert-mode');
                    this.setupPreviewClickEvents();
                    this.showToast('Mode placement activ√© - Cliquez dans votre page HTML pour placer l\'image', 'success');
                } else {
                    btn.textContent = 'üéØ Mode placement d\'images';
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-primary');
                    previewFrame.classList.remove('insert-mode');
                    this.hideInsertIndicator();
                    this.showToast('Mode placement d√©sactiv√©', 'success');
                }
            }

            toggleCodeEditor() {
                const splitView = document.querySelector('.split-view');
                const btn = document.getElementById('toggleCodeBtn');
                
                if (splitView.classList.contains('show-code')) {
                    splitView.classList.remove('show-code');
                    btn.textContent = 'üìù Afficher le code';
                    this.showToast('Code masqu√© - Focus sur l\'aper√ßu', 'success');
                } else {
                    splitView.classList.add('show-code');
                    btn.textContent = 'üåê Masquer le code';
                    this.showToast('Code affich√©', 'success');
                }
            }

            showInsertIndicator(e) {
                const indicator = document.getElementById('insertIndicator');
                indicator.style.left = (e.clientX + 10) + 'px';
                indicator.style.top = (e.clientY - 30) + 'px';
                indicator.classList.add('visible');
            }

            hideInsertIndicator() {
                document.getElementById('insertIndicator').classList.remove('visible');
            }

            downloadHTML() {
                if (!this.htmlContent.trim()) {
                    this.showToast('Aucun contenu √† t√©l√©charger', 'error');
                    return;
                }

                if (this.integrationType === 'base64') {
                    // Mode base64 : un seul fichier HTML avec tout int√©gr√©
                    const blob = new Blob([this.htmlContent], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'fichier_avec_images_integrees.html';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    this.showToast('Fichier HTML t√©l√©charg√© avec images int√©gr√©es!', 'success');
                } else {
                    // Mode fichiers s√©par√©s : t√©l√©charger HTML avec instructions
                    this.downloadWithSeparateImages();
                }
            }

            downloadWithSeparateImages() {
                // Cr√©er un syst√®me de t√©l√©chargement multiple
                this.showToast('Pr√©paration du t√©l√©chargement avec fichiers s√©par√©s...', 'info');

                // 1. T√©l√©charger le HTML
                const htmlBlob = new Blob([this.htmlContent], { type: 'text/html' });
                const htmlUrl = URL.createObjectURL(htmlBlob);
                const htmlLink = document.createElement('a');
                htmlLink.href = htmlUrl;
                htmlLink.download = 'page_avec_images_meme_dossier.html';
                document.body.appendChild(htmlLink);
                htmlLink.click();
                document.body.removeChild(htmlLink);
                URL.revokeObjectURL(htmlUrl);

                // 2. T√©l√©charger chaque image individuellement
                let downloadCount = 0;
                const totalImages = this.images.length;

                if (totalImages > 0) {
                    this.showToast(`T√©l√©chargement de ${totalImages} image(s)...`, 'info');
                    
                    this.images.forEach((image, index) => {
                        setTimeout(() => {
                            // Convertir base64 en blob
                            const base64Data = image.dataUrl.split(',')[1];
                            const mimeType = image.dataUrl.split(';')[0].split(':')[1];
                            const byteCharacters = atob(base64Data);
                            const byteNumbers = new Array(byteCharacters.length);
                            
                            for (let i = 0; i < byteCharacters.length; i++) {
                                byteNumbers[i] = byteCharacters.charCodeAt(i);
                            }
                            
                            const byteArray = new Uint8Array(byteNumbers);
                            const imageBlob = new Blob([byteArray], { type: mimeType });
                            
                            // T√©l√©charger l'image
                            const imageUrl = URL.createObjectURL(imageBlob);
                            const imageLink = document.createElement('a');
                            imageLink.href = imageUrl;
                            imageLink.download = image.fileName;
                            document.body.appendChild(imageLink);
                            imageLink.click();
                            document.body.removeChild(imageLink);
                            URL.revokeObjectURL(imageUrl);
                            
                            downloadCount++;
                            if (downloadCount === totalImages) {
                                this.showDownloadInstructions();
                            }
                        }, index * 500); // D√©lai entre chaque t√©l√©chargement
                    });
                } else {
                    this.showDownloadInstructions();
                }
            }

            showDownloadInstructions() {
                const instructions = `
üéâ T√âL√âCHARGEMENT TERMIN√â !

üìÅ ORGANISATION SIMPLE :

1Ô∏è‚É£ Mettez TOUS les fichiers dans le M√äME DOSSIER
2Ô∏è‚É£ C'est tout ! Aucun sous-dossier n√©cessaire

üìÇ STRUCTURE FINALE :
mon_dossier/
‚îú‚îÄ‚îÄ page_avec_images_meme_dossier.html
${this.images.map(img => `‚îú‚îÄ‚îÄ ${img.fileName}`).join('\n')}

‚úÖ R√âSULTAT : 
‚Ä¢ Page web l√©g√®re
‚Ä¢ Toutes les images dans le m√™me dossier que le HTML
‚Ä¢ Plus simple √† g√©rer !

üîß D√âPANNAGE :
‚Ä¢ Si les images ne s'affichent pas : v√©rifiez que tous les fichiers sont dans le m√™me dossier
‚Ä¢ Pas de sous-dossier "images" n√©cessaire
                `;

                setTimeout(() => {
                    alert(instructions);
                }, 2000);

                this.showToast('Tous les fichiers t√©l√©charg√©s ! Mettez-les dans le m√™me dossier.', 'success');
            }

            clearAll() {
                if (confirm('√ätes-vous s√ªr de vouloir tout effacer ?')) {
                    this.saveState();
                    this.htmlContent = '';
                    this.images = [];
                    document.getElementById('htmlEditor').value = '';
                    this.renderImageGrid();
                    this.refreshPreview();
                    this.updateProgress();
                    this.showToast('Tout a √©t√© effac√©', 'success');
                }
            }

            saveState() {
                this.undoStack.push({
                    htmlContent: this.htmlContent,
                    images: [...this.images]
                });
                this.redoStack = [];
                if (this.undoStack.length > 50) {
                    this.undoStack.shift();
                }
            }

            undo() {
                if (this.undoStack.length > 0) {
                    this.redoStack.push({
                        htmlContent: this.htmlContent,
                        images: [...this.images]
                    });
                    const state = this.undoStack.pop();
                    this.htmlContent = state.htmlContent;
                    this.images = state.images;
                    document.getElementById('htmlEditor').value = this.htmlContent;
                    this.renderImageGrid();
                    this.refreshPreview();
                    this.showToast('Annulation effectu√©e', 'success');
                }
            }

            redo() {
                if (this.redoStack.length > 0) {
                    this.undoStack.push({
                        htmlContent: this.htmlContent,
                        images: [...this.images]
                    });
                    const state = this.redoStack.pop();
                    this.htmlContent = state.htmlContent;
                    this.images = state.images;
                    document.getElementById('htmlEditor').value = this.htmlContent;
                    this.renderImageGrid();
                    this.refreshPreview();
                    this.showToast('R√©tablissement effectu√©', 'success');
                }
            }

            updateProgress() {
                const hasHTML = this.htmlContent.trim().length > 0;
                const hasImages = this.images.length > 0;
                
                let progress = 0;
                let text = 'Pr√™t √† commencer';
                
                if (hasHTML && hasImages) {
                    progress = 100;
                    text = 'Projet complet - Pr√™t √† t√©l√©charger';
                } else if (hasHTML) {
                    progress = 50;
                    text = 'HTML charg√© - Ajoutez des images';
                } else if (hasImages) {
                    progress = 25;
                    text = 'Images ajout√©es - Chargez un fichier HTML';
                }

                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressText').textContent = text;
                
                // Mise √† jour de la barre de statut
                const statusText = `${hasHTML ? 'HTML charg√©' : 'Aucun HTML'} ‚Ä¢ ${this.images.length} image(s)`;
                document.getElementById('statusBar').textContent = statusText;
            }

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 100);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => document.body.removeChild(toast), 300);
                }, 3000);
            }

            showDropIndicator(e) {
                const indicator = document.getElementById('dropIndicator');
                const editor = document.getElementById('htmlEditor');
                const rect = editor.getBoundingClientRect();
                
                indicator.style.left = (e.clientX - 1) + 'px';
                indicator.style.top = rect.top + 'px';
                indicator.style.height = rect.height + 'px';
                indicator.classList.add('visible');
            }

            hideDropIndicator() {
                document.getElementById('dropIndicator').classList.remove('visible');
            }

            getCaretPosition(element) {
                return element.selectionStart;
            }
        }

        // Fonctions globales pour les boutons
        function toggleInsertMode() {
            integrator.toggleInsertMode();
        }

        function toggleCodeEditor() {
            integrator.toggleCodeEditor();
        }

        function refreshPreview() {
            integrator.refreshPreview();
        }

        function downloadHTML() {
            integrator.downloadHTML();
        }

        function clearAll() {
            integrator.clearAll();
        }

        // Fonctions pour les contr√¥les d'images
        window.integrator = null; // Sera d√©fini plus tard

        // Initialisation de l'application
        const integrator = new VisualIntegrator();

        // Message de bienvenue
        setTimeout(() => {
            integrator.showToast('Bienvenue dans L\'Int√©grateur Visuel Am√©lior√©! Commencez par charger un fichier HTML.', 'success');
        }, 1000);
    </script>
</body>
</html>